language: objective-c

env:
  global:
    - OS=mac
      # SAUCE_ACCESS_KEY
    - secure: "YE0n2BcdXokZ/hgcOoptp0bIw+sMKme/+XMNxT01BYqsSN/7KyNkEC5SpAN6K5IYVTBo59QP3EtDQtrsX5uMo9PL84CQzt2wKm2t9yByGIk3TehQ339fdJZKbnd9cVL726fCcDp06Ld73RNh63pc+DglmrKYB5Lx5ElwTs9PnPU="
      # SAUCE_USERNAME
    - secure: "CgBkZlD50ICcik+vYxiKUU/gLGz8G2a62u+k4VoinbOMR9eWk2mk5Qxt4dVMZH2cYVBzFrBooFm/2R+DjrlImM4KoUEtHwW7uPSrEuIGTcIwx7D7wtF1BmJnnnt2Tn5Aq8osYby0plLtPyCQ6TFBDppXc9fnNQnVglZ0HA3XcNE="
  matrix:
    - TARGET=neko macro # run both on same instance
    - TARGET=js TOOLCHAIN="default browser" SAUCE_BROWSERS=sauce-browsers-example.json
    - TARGET=php
    - TARGET=cpp
    - TARGET=flash9 
    - TARGET=as3
    - TARGET=java
    - TARGET=cs
    - TARGET=flash8 
    - TARGET=python 

matrix:
  fast_finish: true
  allow_failures:
    - env: TARGET=flash8 

install:
  - $TRAVIS_BUILD_DIR/setup.sh
  - haxelib install buddy
  - haxelib install utest

script:
  - cd $TRAVIS_BUILD_DIR/tests/fail
  - HXFLAGS="-main Buddy -lib buddy" ~/travis-hx/build.sh
  - $TRAVIS_BUILD_DIR/runtests.sh $FILENAME && exit 1 || echo "fails as expected"
  - HXFLAGS="-main Utest -lib utest" ~/travis-hx/build.sh
  - $TRAVIS_BUILD_DIR/runtests.sh $FILENAME && exit 1 || echo "fails as expected"
  - cd $TRAVIS_BUILD_DIR/tests/success
  - HXFLAGS="-main Buddy -lib buddy" ~/travis-hx/build.sh
  - $TRAVIS_BUILD_DIR/runtests.sh $FILENAME
  - HXFLAGS="-main Utest -lib utest" ~/travis-hx/build.sh
  - $TRAVIS_BUILD_DIR/runtests.sh $FILENAME
