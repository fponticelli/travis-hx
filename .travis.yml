language: objective-c # test mac os builds 

env:
  global:
    - OS=mac
  matrix:
    - TARGET=neko macro FILENAME=unit.n # run both on same instance
    - TARGET=js FILENAME=unit.js TOOLCHAIN=default browser NODECMD="var unit = require('./unit.js').unit; unit.Test.main(); process.exit(unit.Test.success ? 0 \: 1);"
      #- TARGET=php
      #- TARGET=cpp
      #- TARGET=flash9 FILENAME=unit9.swf
      #- TARGET=as3 PATH=$PATH:$HOME/flex_sdk_4/bin
      #- TARGET=java
      #- TARGET=cs
      #- TARGET=flash8 FILENAME=unit8.swf

matrix:
  fast_finish: true
  allow_failures:
    - env: TARGET=flash8

install:
  - travis_retry git clone https://github.com/HaxeFoundation/haxe.git ~/haxegit
  - $TRAVIS_BUILD_DIR/setup.sh

script:
  - cd ~/haxegit/tests/unit
  - haxe compile-$TARGET.hxml
  - $TRAVIS_BUILD_DIR/runtests.sh $FILENAME
